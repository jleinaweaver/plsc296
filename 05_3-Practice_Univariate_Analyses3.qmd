---
format: revealjs
---

## Today's Agenda {background-image="Images/background-data_blue_v4.png" .center}

```{r}
library(tidyverse)
library(readxl)
library(kableExtra)
library(modelsummary)

library(gganimate)

# Data for today
data1 <- read_excel("../Data_in_Class/World_Development_Indicators/WDI-Tidy_Data_Extract-2024-02-07.xlsx", na = "NA")

data2021 <- filter(data1, year == 2021)

fh <- read_excel("../Data_in_Class/Freedom_House/FreedomHouse-Tidy-1972-2023.xlsx")

fh1972 <- filter(fh, year == 1972)

fh2023 <- filter(fh, year == 2023)
```

<br>

::: {.r-fit-text}

**Practicing univariate analyses in R**

- Review: Practice exercises

- New: Freedom House Data

- Canvas: "FreedomHouse-Tidy-1972-2023.xlsx"

:::

<br>

::: r-stack
Justin Leinaweaver (Spring 2025)
:::

::: notes
Prep for Class

1. Review Canvas submissions

<br>

Today we continue practicing our univariate analyses tools in R

- **SLIDE**: Let's kick things off with your practice work for today.
:::


## Practice Exercises {background-image="Images/background-data_blue_v4.png" .center}

<br>

**Questions to Answer:**

1. Are birth rates rising or falling around the world? (`birth_rate`)

2. Is the world getting richer or more unequal over time? (`wb_income`)

::: notes

**In broad strokes, how did this go?**

- **Were you able to use all of our tools on these two variables?**

<br>

**How did you find making an argument in text with statistics as evidence?**

<br>

**SLIDE**: Let's dig into these questions!
:::



## {background-image="Images/background-data_blue_v4.png" .center}

::: {.r-fit-text}
**Are birth rates rising or falling around the world?**
:::

:::: {.columns}
::: {.column width="45%"}
```{r, cache=TRUE, fig.asp=0.618, fig.width=6}
# Snapshot bar plots
# Wikipedia points to a place called Child Trends that argues: Birth rates ranging from 10 to 20 births per 1,000 are considered low, while rates from 40 to 50 births per 1,000 are considered high.
data1 <- data1 |>
  mutate(
    birth_groups = case_when(
      birth_rate <= 20 ~"Low",
      birth_rate < 40 ~"Moderate",
      birth_rate >= 40 ~"High"
    )
  )

data1 |>
  filter(year == 1985) |>
  ggplot(aes(x = birth_rate, fill = birth_groups)) +
  geom_histogram(bins = 20, color = "white", breaks = seq(0,50,2)) +
  labs(x = "(per 1,000 people)", y = "Countries", title = "Global Birth Rates (1985)", caption = "Source: The World Bank's WDI (2024)") +
  xlim(5, 50) +
  scale_fill_manual(values = c("red3", "red3", "lightblue")) +
  guides(fill = "none")

data1 |>
  filter(year == 2021) |>
  ggplot(aes(x = birth_rate, fill = birth_groups)) +
  geom_histogram(bins = 20, color = "white", breaks = seq(0,50,2)) +
  labs(x = "(per 1,000 people)", y = "Countries", title = "Global Birth Rates (2021)", caption = "Source: The World Bank's WDI (2024)") +
  xlim(5, 50) +
  scale_fill_manual(values = c("red3", "red3", "lightblue")) +
  guides(fill = "none")
```
:::

::: {.column width="55%"}

<br>

```{r, cache=TRUE, fig.asp=0.8, fig.width=6}
ggplot(data1, aes(x = birth_rate, fill = birth_groups)) +
  geom_histogram(bins = 20, color = "white") +
  transition_time(year) +
  xlim(5, 50) +
  scale_fill_manual(values = c("red3", "red3", "lightblue")) +
  guides(fill = "none") +
  labs(title = "Global Birth Rates ({as.integer(frame_time)})",
       x = "(per 1,000 people)", y = "Countries",
       caption = "Source: WDI (2024)")
```
:::
::::

::: notes
**So, are birth rates rising or falling around the world?**

- **What was your argument? Why?**

<br>

I'm using benchmarks from a research organization called Child Trends

- They claim to be "the leading research organization in the United States focused solely on improving the lives of children, youth, and families."

- Honestly, I don't know if this is a good source, but this is more a proof of concept rather than a deep analysis of fertility rates.

- They use below 20 and above 40 as birth rates of concern

<br>

**SLIDE**: Global wealth
:::



## {background-image="Images/background-data_blue_v4.png" .center}

::: {.r-fit-text}
**Is the world getting richer or more unequal?**
:::

:::: {.columns}
::: {.column width="45%"}
```{r, cache=TRUE, fig.asp=0.618, fig.width=6}
# Snapshot bar plots
data1 |>
  filter(year == 1985) |>
  ggplot(aes(x = wb_income)) +
  geom_bar(fill = c("blue3", "red", "darkgoldenrod1", "cadetblue3", "grey")) +
  labs(x = "", y = "Countries", title = "World Bank Income Categories (1985)", caption = "Source: WDI (2024)") + 
  scale_x_discrete(limits = c("Low", "Lower-middle", "Upper-middle", "High", NA))

data1 |>
  filter(year == 2021) |>
  ggplot(aes(x = wb_income)) +
  geom_bar(fill = c("blue3", "red", "darkgoldenrod1", "cadetblue3", "grey")) +
  labs(x = "", y = "Countries", title = "World Bank Income Categories (2021)", caption = "Source: The World Bank's WDI (2024)") + 
  scale_x_discrete(limits = c("Low", "Lower-middle", "Upper-middle", "High", NA))
```
:::

::: {.column width="55%"}

<br>

```{r, cache=TRUE, fig.asp=0.8, fig.width=6}
data1 |>
  count(year, wb_income) |>
  ggplot(aes(x = wb_income, y = n)) +
  geom_col(fill = rep(c("blue3", "red", "darkgoldenrod1", "cadetblue3", "grey"), 37)) +
  scale_x_discrete(limits = c("Low", "Lower-middle", "Upper-middle", "High")) +
  labs(title = "World Bank Income Categories ({as.integer(frame_time)})",
       x = "", y = "Countries", caption = "Source: The World Bank's WDI (2024)") + transition_time(year) 
```
:::
::::

::: notes

**So, is the world getting richer or more unequal over time?**

- **What was your argument? Why?**

<br>

I'm hopeful everyone is convinced that the most compelling answer to each question requires:

1. Complete sentence explanations of your answers, 

2. Evidence in visualizations, AND 

3. Evidence in descriptive statistics

<br>

ALSO, the utility of an animation depends on the clarity of the trend over time!

<br>

For the purposes of across time analyses there is absolutely nothing wrong with employing a strategy of using snapshots

- However, let's learn a new tool that let's us do all the snapshots simultaneously

<br>

**SLIDE**: The concept of a stacked bar plot

:::



## {background-image="Images/background-data_blue_v4.png" .center}

::: {.r-fit-text}
**Snapshots in Time Using Stacked Bars**
:::

:::: {.columns}

::: {.column width="50%"}

```{r, cache=TRUE, echo=FALSE, fig.align='center', fig.asp=1.1, fig.retina=3, fig.width=5}
data1 |>
  filter(year == 1985) |>
  ggplot(aes(x = wb_income)) +
  geom_bar(fill = c("blue3", "red", "darkgoldenrod1", "cadetblue3", "grey")) +
  labs(x = "", y = "Countries", title = "World Bank Income Categories (1985)", caption = "Source: WDI (2024)") + 
  scale_x_discrete(limits = c("Low", "Lower-middle", "Upper-middle", "High", NA))
```

:::

::: {.column width="50%"}

```{r, cache=TRUE, echo=FALSE, fig.align='center', fig.asp=1.1, fig.retina=3, fig.width=5}
data1$wb_income_f <- factor(data1$wb_income, 
    levels = c(NA, "High", "Upper-middle", "Lower-middle", "Low"))

data1 |>
  filter(year == 1985) |>
  ggplot(aes(x = year, fill = wb_income_f)) +
  geom_bar() +
  scale_x_continuous(limits = c(1983.5, 1986.5), labels = NULL) +
  labs(x = "", y = "Countries", title = "World Bank Income Categories (1985)", caption = "Source: WDI (2024)") +
  scale_fill_manual(values = c("blue3", "cadetblue3", "darkgoldenrod1", "red", "grey"))
```

:::
::::

::: notes

**Does everybody see how these two plots represent the exact same data in equivalent ways?**

- The left plot is the standard version, what we call side-by-side bars or a dodge bar plot

- The right plot stacks all of the bars on top of each other

<br>

Let's use this strategy but expand it for all years!

- To start, everybody make a bar plot of `year` in the World Bank data

- (**SLIDE**)

:::






## {background-image="Images/background-data_blue_v4.png" .center}

```{r, cache=TRUE, echo=TRUE, fig.align='center', fig.asp=0.618}
# Observations counted across time
ggplot(data1, aes(x = year)) +
  geom_bar()
```

::: notes

**Ok, what did you just make? What do these bars represent?**

<br>

Each bar is a count of observations for each year in the dataset 

- Here we see there are the same number of observations in each year I've provided you

<br>

**SLIDE**: Now, let's put the data back into this plot
:::



## {background-image="Images/background-data_blue_v4.png" .center}

```{r, cache=TRUE, echo=TRUE, fig.align='center', fig.asp=0.618}
# Counts of one variable across time
ggplot(data1, aes(x = year, fill = wb_income)) +
  geom_bar()
```

::: notes

Kind of cool, right?

- Think of this like what you've been doing all semester to "fill" in the bars with color

- This tells R to "fill" in the bars with a different variable!

<br>

**Did everybody make this?**

<br>

One problem here is that the levels in our status variable are not in a logical order

- **SLIDE**: Let's fix it
:::



## {background-image="Images/background-data_blue_v4.png" .center}

```{r, cache=TRUE, echo=TRUE, fig.align='center', fig.asp=0.618}
# Create a new variable using factor()
data1$wb_income_f <- factor(data1$wb_income, 
    levels = c(NA, "High", "Upper-middle", "Lower-middle", "Low"))

ggplot(data1, aes(x = year, fill = wb_income_f)) +
  geom_bar()
```

::: notes

*Talk them through creating a new variable*

- Don't overwrite your variables, make new ones!

- The levels represents the order you want

<br>

**Everybody get this?**

<br>

**SLIDE**: Before we analyze, let's fix the colors
:::



## {background-image="Images/background-data_blue_v4.png" .center}

```{r, cache=TRUE, echo=TRUE, fig.align='center', fig.asp=0.618}
# Add colors
ggplot(data1, aes(x = year, fill = wb_income_f)) +
  geom_bar() +
  scale_fill_manual(values = c("deepskyblue4", "deepskyblue1", 
                               "pink", "red3"))
```

::: notes

Scale fill manual lets you specify colors by the fill categories.

- You can then enter certain color names using hexadecimal codes or some words

- I put an R color cheatsheet on our Canvas Modules page

<br>

**Back to the visualization, what do we learn from this about the world?**

<br>

**SLIDE**: One more tweak possible here...
:::


## {background-image="Images/background-data_blue_v4.png" .center}

```{r, cache=TRUE, echo=TRUE, fig.align='center', fig.asp=0.618}
# Convert the counts to proportions
ggplot(data1, aes(x = year, fill = wb_income_f)) +
  geom_bar(position = "fill") +
  scale_fill_manual(values = c("deepskyblue4", "deepskyblue1", 
                               "pink", "red3")) +
  scale_y_continuous(labels = scales::percent_format())
```

::: notes

Position = 'fill' asks the bar plot to convert itself into proportions on the y axis

- Think of this like using the proportions() function

<br>

**How does this change our conclusions?**

<br>

**Why is this SUPER risky?**

- Completely hides the change in the number of countries per year

- Assumes changes in % are the same when there are 149 countries vs 210...

<br>

**SLIDE**: Let's practice this!
:::
















































## {background-image="Images/05_2-Freedom_House1.png" .center}

::: notes

Today we practice our univariate analysis tools by examining some of the data produced by Freedom House.

**In very broad strokes, what is the purpose of the measures produced by Freedom House?**

- **What are they trying to measure?**

<br>

Freedom House's "Freedom in the World" project is an attempt to quantify "freedom" in countries across the world in terms of "political rights" and "civil liberties"

<br>

**According to Freedom House, what is the difference between "political rights" and "civil liberties"?**

Political Rights in three subcategories:
    
1. Electoral Process (3 questions), 
2. Political Pluralism and Participation (4), and
3. Functioning of Government (3).
    
Civil liberties in four subcategories:
    
1. Freedom of Expression and Belief (4 questions),
2. Associational and Organizational Rights (3), 
3. Rule of Law (4), and 
4. Personal Autonomy and Individual Rights (4).)

<br>

If we had chosen Freedom House as our data set we would need to spend quite a bit of time digging into these conceptual labels.

- How distinct are they? 

- Are these valid definitions? Are they reliable?

<br>

Our focus today is to practice our univariate analyses so we'll set methodology aside for the moment.
:::



## Exercise 1 {background-image="Images/background-data_blue_v4.png" .center}

<br>

### How is global freedom changing across time?

<br>

### Visualize FH `status` in 1972 and 2023

::: notes

Alright, let's crunch some data!

- Answer my question with two visualizations!

<br>

**What's the answer to our question?**

- **How did you get to that answer?**

- (**SLIDE**)
:::


## {background-image="Images/background-data_blue_v4.png" .center}

::: {.r-fit-text}
**How is global freedom changing across time?**
:::

:::: {.columns}
::: {.column width="50%"}
```{r, cache=TRUE, fig.retina=3, out.width='100%', fig.asp=0.85, fig.width=5}
fh |>
  filter(year == 1972) |>
  ggplot(aes(x = status)) +
  geom_bar(fill = c("cornflowerblue", "red3", "pink")) +
  labs(title = "Freedom House Status (1972)", x = "", y = "Countries",
       caption = "Source: Freedom House (2024)") +
  scale_x_discrete(limits = c("NF", "PF", "F"), labels = c("Not Free", "Partly Free", "Free")) +
  ylim(0, 85)
```
:::

::: {.column width="50%"}
```{r, cache=TRUE, fig.retina=3, out.width='100%', fig.asp=0.85, fig.width=5}
fh |>
  filter(year == 2023) |>
  ggplot(aes(x = status)) +
  geom_bar(fill = c("cornflowerblue", "red3", "pink")) +
  labs(title = "Freedom House Status (2023)", x = "", y = "Countries",
       caption = "Source: Freedom House (2024)") +
  scale_x_discrete(limits = c("NF", "PF", "F"), labels = c("Not Free", "Partly Free", "Free")) +
  ylim(0, 85)
```
:::
::::

::: notes

A big problem for us in interpreting these counts is that the number of countries being studied increased DRAMATICALLY between the two ends of our dataset

- 1972 obs: `r nrow(fh1972)`

- 2023 obs: `r nrow(fh2023)`

- +`r round((nrow(fh2023)/nrow(fh1972)-1)*100, 1)`%

<br>

Key lesson: IF the sample changes across time, then counts and proportions are very dangerous to interpret!

- We really can't tell from this if states are becoming more free or if new states are more likely to be free

<br>

**Make sense?**

<br>

**SLIDE**: Let's try some alternative analyses to see if we can unpack what is happening here.

:::



## {background-image="Images/background-data_blue_v4.png" .center}

::: {.r-fit-text}
**How is global freedom changing across time?**

<br>

- Make a bar plot of `year`
:::

::: notes

To start, everybody make me a bar plot of the number of countries in each year in the full dataset

- We're going to treat `year` as a categorical variable

- So, our aim is to count countries in each year

<br>

(**SLIDE**)

:::



## {background-image="Images/background-data_blue_v4.png" .center}

```{r, cache=TRUE, echo=TRUE, fig.align='center', fig.asp=0.618}
# Observations counted across time
ggplot(fh, aes(x = year)) +
  geom_bar()
```

::: notes
**What do we learn from this about the world and about Freedom House?**

- (Spike in 1991 as USSR collapses so maybe some new countries were more free?)

- (Not as sure about that spike in 2023)

<br>

**SLIDE**: Now, we can also take this one step further by tracking the count of each type of country in this plot.
:::



## {background-image="Images/background-data_blue_v4.png" .center}

```{r, cache=TRUE, echo=TRUE, fig.align='center', fig.asp=0.618}
# Counts of one variable across time
ggplot(fh, aes(x = year, fill = status)) +
  geom_bar()
```

::: notes

Kind of cool, right?

- Think of this like what you've been doing all semester to "fill" in the bars with color

- This tells R to "fill" in the bars with a different variable!

<br>

**Did everybody make this?**

<br>

One problem here is that the levels in our status variable are not in a logical order

- Should probably go NF, PF to F on top

- **SLIDE**
:::



## {background-image="Images/background-data_blue_v4.png" .center}

```{r, cache=TRUE, echo=TRUE, fig.align='center', fig.asp=0.618}
# Create a new variable using factor()
fh$status_f <- factor(fh$status, levels = c("F", "PF", "NF"))

ggplot(fh, aes(x = year, fill = status_f)) +
  geom_bar()
```

::: notes

*Talk them through creating a new variable*

- Don't overwrite your variables, make new ones!

- The levels represents the order you want

<br>

**Everybody get this?**

<br>

**SLIDE**: Before we analyze, let's fix the colors
:::



## {background-image="Images/background-data_blue_v4.png" .center}

```{r, cache=TRUE, echo=TRUE, fig.align='center', fig.asp=0.618}
# Add colors
ggplot(fh, aes(x = year, fill = status_f)) +
  geom_bar() +
  scale_fill_manual(values = c("cornflowerblue", "pink", "red3"))
```

::: notes

Scale fill manual lets you specify colors by the fill categories.

- You can then enter certain color names using hexadecimal codes or some words

- I put an R color cheatsheet on our Canvas Modules page

<br>

**Back to the visualization, what do we learn from this about the world and about Freedom House?**

<br>

**SLIDE**: One more tweak possible here...
:::


## {background-image="Images/background-data_blue_v4.png" .center}

```{r, cache=TRUE, echo=TRUE, fig.align='center', fig.asp=0.618}
# Convert the counts to proportions
ggplot(fh, aes(x = year, fill = status_f)) +
  geom_bar(position = "fill") +
  scale_fill_manual(values = c("cornflowerblue", "pink", "red3")) +
  scale_y_continuous(labels = scales::percent_format())
```

::: notes

Position = 'fill' asks the bar plot to convert itself into proportions on the y axis

- Think of this like using the proportions() function

<br>

**How does this change our conclusions?**

<br>

**Why is this SUPER risky?**

- Completely hides the change in the number of countries per year

- Assumes changes in % are the same when there are 149 countries vs 210...

<br>

**SLIDE**: Let's practice this!
:::



## {background-image="Images/background-data_blue_v4.png" .center}

::: {.r-fit-text}
**How are political rights changing across time?**
:::

<br>

- Make a stacked bar plot of `year` and `pr`

- Use `fill = factor(pr)` to tell R to treat it as a categorical variable

::: notes

(**SLIDE**: My version)

:::



## {background-image="Images/background-data_blue_v4.png" .center}

```{r, cache=TRUE, echo=TRUE, fig.align='center', fig.asp=0.618}
ggplot(fh, aes(x = year, fill = factor(pr, levels = 7:1))) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(x = "", y = "", title = "Political Rights Across Time",
       caption = "Source: Freedom House (2024)", fill = "") +
  scale_fill_brewer(type = "div", palette = "RdYlBu")
```

::: notes

Two new bits of code here.

- Rather than manually specify the colors I'm using a built-in tool called R Color Brewer

- I'm removing the label in the legend with fill = ""

<br>

**What do we learn from this?**

- Remember, smaller numbers are better on this scale.

- (Worrying increase in the worst of the worst)

<br>

Everybody now repeat this exact code but do it for the civil liberties variable (`cl`).

- (**SLIDE**: My version)

:::



## {background-image="Images/background-data_blue_v4.png" .center}

```{r, cache=TRUE, echo=TRUE, fig.align='center', fig.asp=0.618}
ggplot(fh, aes(x = year, fill = factor(cl, levels = 7:1))) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(x = "", y = "", title = "Civil Liberties Across Time",
       caption = "Source: Freedom House (2024)", fill = "") +
  scale_fill_brewer(type = "div", palette = "RdYlBu")
```

::: notes

**What do we learn from this?**

<br>

**Everybody feeling pretty comfortable making stacked bar plots?**

<br>

**SLIDE**: Let's now zoom in on some specific cases

:::



## {background-image="Images/background-data_blue_v4.png" .center}

::: {.r-fit-text}
**How is freedom changing in the US across time?**
:::

<br>

::: {.r-fit-text}
- Make a line plot of `fh_total` for the US only
:::

::: notes

A second option for tracking change across time is to focus on a single observation

<br>

- Filter the dataset to only include the US

- geom_line()
:::



## {background-image="Images/background-data_blue_v4.png" .center}

```{r, echo=TRUE, cache=TRUE, fig.align='center', fig.asp=0.618, fig.width=7}
fh_US <- filter(fh, fh_country == "United States")

ggplot(fh_US, aes(x = year, y = fh_total)) +
  geom_line() +
  labs(x = "", y = "Freedom House Total Score (1-14)", 
       caption = "Source: Freedom House (2024)") +
  scale_y_continuous(limits = c(1,7), breaks = 1:7)
```

::: notes

A fairly stable story over time, right?

- Something weird happened in 2016...

<br>

Everybody try this again but find us a country with tons of yearly variation!

<br>

**Report back, what countries are basket cases per this measure?**

```{r}
# Find cases with conflicting CL and PR
# fh |> 
#   group_by(fh_country) %>% 
#   summarize(
#     cor = cor(pr, cl, use="pairwise")
#   ) |>
#   arrange(cor) |>
#   print(n = 250)
# 
# # Italy?
# fh_1 <- filter(fh, fh_country == "Israel")
# 
# print(fh_1, n=50)
# 
# ggplot(fh_US, aes(x = year, y = pr)) +
#   geom_line() +
#   labs(x = "", y = "Political Rights (1-7)", 
#        caption = "Source: Freedom House (2024)") +
#   scale_y_continuous(limits = c(1,7), breaks = 1:7)

```

:::


























